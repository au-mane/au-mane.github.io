import{X as S,s as ue,e as C,t as O,b as H,i as k,j as q,l as j,d as w,f as K,m as T,J as M,n as I,o as A,H as L,G as P,p as B,v as U,x as de,Y as he,E as me,z as x,Z as $,_ as Q,$ as ye,a0 as ee,P as be,a1 as te,a2 as V,K as ve,a3 as we,a4 as Ae,a5 as Te}from"./scheduler.D0aYECZP.js";import{S as ge,i as _e}from"./index.DKSt-8--.js";import{e as ae}from"./Header.B6j_zJBV.js";import{s as b,a as Ce}from"./FormSkeleton.DOsiBcVP.js";import{w as p}from"./index.2cg2wEKR.js";const J=p([]);let R=!1;async function F(t="",e=""){if(R)return S(J);R=!0;let a=[];if(t&&e){const l=`${e}T23:59:59`,{data:s,error:c}=await b.from("transactions").select("*").gte("date",t).lte("date",l).order("date",{ascending:!1});if(c)throw c;a=s||[],J.set(a)}else{const{data:l,error:s}=await b.from("transactions").select("*").order("date",{ascending:!1});if(s)throw s;a=l||[],J.set(a)}return R=!1,a}async function Ue(t){const{data:e,error:a}=await b.from("transactions").insert([t]).select();if(a)throw a;return await F(),e?e[0]:void 0}async function We(t,e){const{data:a,error:l}=await b.from("transactions").update(e).eq("id",t).select();if(l)throw l;return await F(),a?a[0]:void 0}async function ze(t){const{error:e}=await b.from("transactions").delete().eq("id",t);if(e)throw e;await F()}const le=p([]);let X=!1;async function z(){if(X)return S(le);X=!0;const{data:t,error:e}=await b.from("bills").select("*").order("created_at",{ascending:!0});if(e)throw e;const a=t||[];return le.set(a),X=!1,a}async function Ge(t){const{data:e,error:a}=await b.from("bills").insert([t]).select();if(a)throw a;return await z(),e?e[0]:void 0}async function Je(t,e){const{data:a,error:l}=await b.from("bills").update(e).eq("id",t).select();if(l)throw l;return await z(),a?a[0]:void 0}async function Re(t){const{error:e}=await b.from("bills").delete().eq("id",t);if(e)throw e;await z()}function se(t){let e,a;return{c(){e=C("small"),a=O(t[3]),this.h()},l(l){e=k(l,"SMALL",{class:!0});var s=q(e);a=j(s,t[3]),s.forEach(w),this.h()},h(){T(e,"class","fw-lighter fst-italic"),M(e,"text-danger",t[7])},m(l,s){I(l,e,s),A(e,a)},p(l,s){s&8&&B(a,l[3]),s&128&&M(e,"text-danger",l[7])},d(l){l&&w(e)}}}function ke(t){let e,a,l,s,c,o,v,h,r,i=t[3]&&se(t);return{c(){e=C("div"),a=C("div"),l=O(t[1]),s=O(t[9]),c=H(),o=C("input"),v=H(),i&&i.c(),this.h()},l(n){e=k(n,"DIV",{class:!0});var d=q(e);a=k(d,"DIV",{});var y=q(a);l=j(y,t[1]),s=j(y,t[9]),y.forEach(w),c=K(d),o=k(d,"INPUT",{name:!0,type:!0,class:!0,placeholder:!0}),v=K(d),i&&i.l(d),d.forEach(w),this.h()},h(){T(o,"name",t[2]),T(o,"type","text"),T(o,"class","form-control"),T(o,"placeholder",t[4]),o.disabled=t[5],o.required=t[6],M(o,"is-invalid",t[7]),T(e,"class","d-flex flex-column gap-1")},m(n,d){I(n,e,d),A(e,a),A(a,l),A(a,s),A(e,c),A(e,o),t[11](o),L(o,t[0]),A(e,v),i&&i.m(e,null),h||(r=[P(o,"focus",t[12]),P(o,"input",t[13]),P(o,"keyup",t[10])],h=!0)},p(n,[d]){d&2&&B(l,n[1]),d&512&&B(s,n[9]),d&4&&T(o,"name",n[2]),d&16&&T(o,"placeholder",n[4]),d&32&&(o.disabled=n[5]),d&64&&(o.required=n[6]),d&1&&o.value!==n[0]&&L(o,n[0]),d&128&&M(o,"is-invalid",n[7]),n[3]?i?i.p(n,d):(i=se(n),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i:U,o:U,d(n){n&&w(e),t[11](null),i&&i.d(),h=!1,de(r)}}}function pe(t,e,a){let l,{label:s=""}=e,{name:c=""}=e,{helperText:o=""}=e,{placeholder:v=""}=e,{value:h}=e,{loading:r}=e,{required:i}=e,{isInvalid:n}=e,d;const y=he(),_=()=>{y("valueChanged",{value:h})};function f(g){me[g?"unshift":"push"](()=>{d=g,a(8,d)})}const u=()=>d.select();function m(){h=this.value,a(0,h)}return t.$$set=g=>{"label"in g&&a(1,s=g.label),"name"in g&&a(2,c=g.name),"helperText"in g&&a(3,o=g.helperText),"placeholder"in g&&a(4,v=g.placeholder),"value"in g&&a(0,h=g.value),"loading"in g&&a(5,r=g.loading),"required"in g&&a(6,i=g.required),"isInvalid"in g&&a(7,n=g.isInvalid)},t.$$.update=()=>{t.$$.dirty&64&&a(9,l=i?"*":"")},[h,s,c,o,v,r,i,n,d,l,_,f,u,m]}class Xe extends ge{constructor(e){super(),_e(this,e,pe,ke,ue,{label:1,name:2,helperText:3,placeholder:4,value:0,loading:5,required:6,isInvalid:7})}}function ne(t,e,a){const l=t.slice();return l[12]=e[a],l}function re(t){let e,a,l,s,c,o,v,h,r=t[1]&&ie(t),i=ae(t[2]),n=[];for(let f=0;f<i.length;f+=1)n[f]=oe(ne(t,i,f));let d=[t[8],{class:"form-select"},{disabled:c=t[3]||t[4]},{"aria-label":t[1]}],y={};for(let f=0;f<d.length;f+=1)y=Q(y,d[f]);let _=t[5]&&ce(t);return{c(){e=C("div"),r&&r.c(),a=H(),l=C("select"),s=C("option");for(let f=0;f<n.length;f+=1)n[f].c();o=H(),_&&_.c(),this.h()},l(f){e=k(f,"DIV",{class:!0});var u=q(e);r&&r.l(u),a=K(u),l=k(u,"SELECT",{class:!0,"aria-label":!0});var m=q(l);s=k(m,"OPTION",{}),q(s).forEach(w);for(let g=0;g<n.length;g+=1)n[g].l(m);m.forEach(w),o=K(u),_&&_.l(u),u.forEach(w),this.h()},h(){s.__value="",L(s,s.__value),ee(l,y),t[0]===void 0&&be(()=>t[10].call(l)),T(e,"class","d-flex flex-column gap-1")},m(f,u){I(f,e,u),r&&r.m(e,null),A(e,a),A(e,l),A(l,s);for(let m=0;m<n.length;m+=1)n[m]&&n[m].m(l,null);"value"in y&&(y.multiple?te:V)(l,y.value),l.autofocus&&l.focus(),V(l,t[0],!0),A(e,o),_&&_.m(e,null),v||(h=[P(l,"change",t[10]),P(l,"change",t[7])],v=!0)},p(f,u){if(f[1]?r?r.p(f,u):(r=ie(f),r.c(),r.m(e,a)):r&&(r.d(1),r=null),u&4){i=ae(f[2]);let m;for(m=0;m<i.length;m+=1){const g=ne(f,i,m);n[m]?n[m].p(g,u):(n[m]=oe(g),n[m].c(),n[m].m(l,null))}for(;m<n.length;m+=1)n[m].d(1);n.length=i.length}ee(l,y=Ce(d,[u&256&&f[8],{class:"form-select"},u&24&&c!==(c=f[3]||f[4])&&{disabled:c},u&2&&{"aria-label":f[1]}])),u&282&&"value"in y&&(y.multiple?te:V)(l,y.value),u&5&&V(l,f[0]),f[5]?_?_.p(f,u):(_=ce(f),_.c(),_.m(e,null)):_&&(_.d(1),_=null)},d(f){f&&w(e),r&&r.d(),ve(n,f),_&&_.d(),v=!1,de(h)}}}function ie(t){let e,a,l;return{c(){e=C("div"),a=O(t[1]),l=O(t[6])},l(s){e=k(s,"DIV",{});var c=q(e);a=j(c,t[1]),l=j(c,t[6]),c.forEach(w)},m(s,c){I(s,e,c),A(e,a),A(e,l)},p(s,c){c&2&&B(a,s[1]),c&64&&B(l,s[6])},d(s){s&&w(e)}}}function oe(t){let e,a=t[12].key+"",l,s;return{c(){e=C("option"),l=O(a),this.h()},l(c){e=k(c,"OPTION",{});var o=q(e);l=j(o,a),o.forEach(w),this.h()},h(){e.__value=s=t[12].value,L(e,e.__value)},m(c,o){I(c,e,o),A(e,l)},p(c,o){o&4&&a!==(a=c[12].key+"")&&B(l,a),o&4&&s!==(s=c[12].value)&&(e.__value=s,L(e,e.__value))},d(c){c&&w(e)}}}function ce(t){let e,a;return{c(){e=C("small"),a=new we(!1),this.h()},l(l){e=k(l,"SMALL",{class:!0});var s=q(e);a=Ae(s,!1),s.forEach(w),this.h()},h(){a.a=null,T(e,"class","fw-lighter fst-italic")},m(l,s){I(l,e,s),a.m(t[5],e)},p(l,s){s&32&&a.p(l[5])},d(l){l&&w(e)}}}function qe(t){let e,a=t[2].length>0&&re(t);return{c(){a&&a.c(),e=x()},l(l){a&&a.l(l),e=x()},m(l,s){a&&a.m(l,s),I(l,e,s)},p(l,[s]){l[2].length>0?a?a.p(l,s):(a=re(l),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null)},i:U,o:U,d(l){l&&w(e),a&&a.d(l)}}}function De(t,e,a){let l;const s=["label","options","value","loading","required","disabled","helperText"];let c=$(e,s),{label:o=""}=e,{options:v}=e,{value:h}=e,{loading:r=!1}=e,{required:i=!1}=e,{disabled:n}=e,{helperText:d=""}=e;const y=he(),_=()=>{y("change",{value:h})};function f(){h=Te(this),a(0,h),a(2,v)}return t.$$set=u=>{e=Q(Q({},e),ye(u)),a(8,c=$(e,s)),"label"in u&&a(1,o=u.label),"options"in u&&a(2,v=u.options),"value"in u&&a(0,h=u.value),"loading"in u&&a(3,r=u.loading),"required"in u&&a(9,i=u.required),"disabled"in u&&a(4,n=u.disabled),"helperText"in u&&a(5,d=u.helperText)},t.$$.update=()=>{t.$$.dirty&512&&a(6,l=i?"*":"")},[h,o,v,r,n,d,l,_,c,i,f]}class Ye extends ge{constructor(e){super(),_e(this,e,De,qe,ue,{label:1,options:2,value:0,loading:3,required:9,disabled:4,helperText:5})}}const W=p([]);let Y=!1;async function N(){if(Y)return S(W);Y=!0;const{data:t,error:e}=await b.from("accounts").select("*").order("name",{ascending:!0});if(e)throw e;const a=t||[];return W.set(a),Y=!1,a}async function Ee(t){let e=S(W);return e.length||(await N(),e=S(W)),e.find(a=>a.id===t)}async function Ie(t){const{data:e,error:a}=await b.from("accounts").insert([t]).select();if(a)throw a;return await N(),e?e[0]:void 0}async function Se(t,e){const{data:a,error:l}=await b.from("accounts").update(e).eq("id",t).select();if(l)throw l;return await N(),a?a[0]:void 0}async function Oe(t){const{error:e}=await b.from("accounts").delete().eq("id",t);if(e)throw e;await N()}let D=null;const je=()=>{const t=p(!1),e=p([]),a=p();return D={stores:{loading:t,targetAccount:a,data:e},actions:{reload:async()=>{t.set(!0);const r=await N();e.set(r),t.set(!1)},createAccount:async r=>{t.set(!0);try{await Ie(r)}catch(i){console.error(i)}finally{t.set(!1)}},updateAccount:async(r,i)=>{t.set(!0);try{await Se(r,i)}catch(n){console.error(n)}finally{t.set(!1)}},deleteAccount:async r=>{t.set(!0);try{await Oe(r)}catch(i){console.error(i)}finally{t.set(!1)}},canDeleteAccount:async r=>{t.set(!0);try{const n=(await F()).filter(_=>_.account_id===r),y=(await z()).filter(_=>_.account_id===r);return n.length===0&&y.length===0}catch(i){console.error(i)}finally{t.set(!1)}},getAccount:async r=>{t.set(!0);try{return await Ee(r)}catch(i){console.error(i)}finally{t.set(!1)}}}},D},Ze=()=>D?.stores&&Object.keys(D.stores).length>0&&D?.actions&&Object.keys(D.actions).length>0?D:je(),Qe=()=>{D=null},fe=p([]);let Z=!1;async function G(){if(Z)return S(fe);Z=!0;const{data:t,error:e}=await b.from("categories").select("*").order("name",{ascending:!0});if(e)throw e;const a=t||[];return fe.set(a),Z=!1,a}async function Be(t){const{data:e,error:a}=await b.from("categories").insert([t]).select();if(a)throw a;return await G(),e?e[0]:void 0}async function Pe(t,e){const{data:a,error:l}=await b.from("categories").update(e).eq("id",t).select();if(l)throw l;return await G(),a?a[0]:void 0}async function Le(t){const{error:e}=await b.from("categories").delete().eq("id",t);if(e)throw e;await G()}let E=null;const Fe=()=>{const t=p(!1),e=p([]),a=p();return E={stores:{loading:t,targetCategory:a,data:e},actions:{reload:async()=>{t.set(!0);const h=await G();e.set(h),t.set(!1)},createCategory:async h=>{t.set(!0);try{await Be(h)}catch(r){console.error(r)}finally{t.set(!1)}},updateCategory:async(h,r)=>{t.set(!0);try{await Pe(h,r)}catch(i){console.error(i)}finally{t.set(!1)}},canDeleteCategory:async h=>{t.set(!0);try{return(await F()).filter(n=>n?.category_id&&n?.category_id===h)?.length===0}catch(r){console.error(r)}finally{t.set(!1)}},deleteCategory:async h=>{t.set(!0);try{await Le(h)}catch(r){console.error(r)}finally{t.set(!1)}}}},E},xe=()=>E?.stores&&Object.keys(E.stores).length>0&&E?.actions&&Object.keys(E.actions).length>0?E:Fe(),$e=()=>{E=null};export{Ye as S,Xe as T,Ze as a,Qe as b,z as c,$e as d,Re as e,F as f,xe as g,Ge as h,ze as i,Ue as j,We as k,Je as u};
