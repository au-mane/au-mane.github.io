import{w as n}from"./index.CCnsF9wr.js";import{s as c}from"./supabase-config.Y8iSvhNi.js";import{b as u}from"./scheduler.CBku5hu2.js";import{g as C}from"./TextField.D8bvZ5xU.js";const d=n([]);let y=!1;async function i(){if(y)return u(d);y=!0;const{data:t,error:e}=await c.from("categories").select("*");if(e)throw e;const a=t||[];return d.set(a),y=!1,a}async function w(t){const{data:e,error:a}=await c.from("categories").insert([t]).select();if(a)throw a;return await i(),e?e[0]:void 0}async function h(t,e){const{data:a,error:l}=await c.from("categories").update(e).eq("id",t).select();if(l)throw l;return await i(),a?a[0]:void 0}async function p(t){const{error:e}=await c.from("categories").delete().eq("id",t);if(e)throw e;await i()}let s=null;const m=()=>{const t=n(!1),e=n([]),a=n();return s={stores:{loading:t,targetCategory:a,data:e},actions:{reload:async()=>{t.set(!0);const r=await i();e.set(r),t.set(!1)},createCategory:async r=>{t.set(!0);try{await w(r)}catch(o){console.error(o)}finally{t.set(!1)}},updateCategory:async(r,o)=>{t.set(!0);try{await h(r,o)}catch(g){console.error(g)}finally{t.set(!1)}},canDeleteCategory:async r=>{t.set(!0);try{return(await C()).filter(f=>f?.category_id&&f?.category_id===r)?.length===0}catch(o){console.error(o)}finally{t.set(!1)}},deleteCategory:async r=>{t.set(!0);try{await p(r)}catch(o){console.error(o)}finally{t.set(!1)}}}},s},T=()=>s?.stores&&Object.keys(s.stores).length>0&&s?.actions&&Object.keys(s.actions).length>0?s:m(),j=()=>{s=null};export{j as d,T as g};
